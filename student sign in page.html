<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Bus Pass System</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #eef2ff;
      margin: 0;
      padding: 0;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://jayshriram.edu.in/wp-content/uploads/2023/09/Collage-Campus.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.1;
      z-index: -1;
    }

    .container {
      max-width: 500px;
      margin: 60px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
    }

    .logo {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      background-image: url('https://educrib-uploads.blr1.cdn.digitaloceanspaces.com/colleges/logos/Jai%20Shriram%20Engineering%20College%2C%20Tirupur%20logo.jpg');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #1e3a8a;
    }

    label {
      margin-top: 10px;
      display: block;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 16px;
    }

    button {
      cursor: pointer;
      background-color: #4f46e5;
      color: white;
      font-weight: bold;
      border: none;
      transition: 0.3s;
    }

    button:hover {
      background-color: #4338ca;
    }

    .toggle-links {
      text-align: center;
      margin-top: 15px;
    }

    .toggle-links a {
      color: #4f46e5;
      cursor: pointer;
      text-decoration: underline;
    }

    .hidden { display: none; }

    .qr-section {
      text-align: center;
      margin-top: 20px;
    }

    .qr-section img {
      width: 200px;
      height: 200px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    #billSection, #busPassSection {
      text-align: center;
      margin-top: 20px;
    }

    canvas {
      margin-top: 20px;
      border: 2px solid #444;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    #downloadBtn {
      background-color: #16a34a;
      margin-top: 10px;
    }

    #generateBtn[disabled] {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    .payment-info {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
    }
    
    .upi-id {
      font-size: 18px;
      font-weight: bold;
      color: #1e3a8a;
      margin: 10px 0;
    }
    
    .bank-info {
      font-size: 14px;
      color: #555;
      margin: 5px 0;
    }
  </style>
</head>
<body>

<!-- Sign In -->
<div class="container" id="signInSection">
  <div class="logo"></div>
  <h2>Student Sign In</h2>
  <label for="signInRegNo">Register Number</label>
  <input type="text" id="signInRegNo" placeholder="Enter your register number" required>

  <label for="signInDob">Date of Birth</label>
  <input type="date" id="signInDob" required>

  <button onclick="signIn()">Sign In</button>

  <div class="toggle-links">
    <p>New user? <a onclick="showSignUp()">Sign Up</a></p>
  </div>
</div>

<!-- Sign Up -->
<div class="container hidden" id="signUpSection">
  <div class="logo"></div>
  <h2>Student Sign Up</h2>
  <label for="regNo">Register Number</label>
  <input type="text" id="regNo" placeholder="Enter your register number" required>

  <label for="dob">Date of Birth</label>
  <input type="date" id="dob" required>

  <label for="name">Full Name</label>
  <input type="text" id="name" placeholder="Enter your name" required>

  <label for="dept">Department</label>
  <input type="text" id="dept" placeholder="Enter your department" required>

  <label for="year">Year</label>
  <select id="year" required>
    <option value="">Select Year</option>
    <option value="I">I Year</option>
    <option value="II">II Year</option>
    <option value="III">III Year</option>
    <option value="IV">IV Year</option>
  </select>

  <label for="stop">Stop Name</label>
  <select id="stop" required>
    <option value="">Select Stop</option>
    <option value="Puthu road">Puthu road</option>
    <option value="Kovilvali">Kovilvali</option>
    <option value="GH">GH</option>
    <option value="Tirupur">Tirupur</option>
    <option value="Avinashipalayam">Avinashipalayam</option>
    <option value="Kadaiyur">Kadaiyur</option>
    <option value="Kangeyam">Kangeyam</option>
    <option value="Vellakovil">Vellakovil</option>
    <option value="Koduvai">Koduvai</option>
    <option value="Madhapur">Madhapur</option>
    <option value="Pongalur">Pongalur</option>
    <option value="Palladam">Palladam</option>
    <option value="Varapalayam">Varapalayam</option>
    <option value="Kangeyam privu">Kangeyam privu</option>
    <option value="Tharapuram">Tharapuram</option>
  </select>

  <label for="photo">Upload Student Photo</label>
  <input type="file" id="photo" accept="image/*" required>

  <button onclick="registerUser()">Sign Up</button>

  <div class="toggle-links">
    <p>Already have an account? <a onclick="showSignIn()">Sign In</a></p>
  </div>
</div>

<!-- Payment -->
<div class="container hidden" id="paymentSection">
  <div class="logo"></div>
  <h2>Pay Bus Fees</h2>
  <p id="studentSummary"></p>

  <label for="paymentMethod">Choose Payment Method</label>
  <select id="paymentMethod" onchange="showPaymentOption()">
    <option value="">-- Select Payment Option --</option>
    <option value="upi">UPI QR Code</option>
    <option value="upiid">UPI ID</option>
    <option value="gpay">GPay</option>
    <option value="card">Card</option>
  </select>

  <div id="paymentOptions" class="qr-section hidden">
    <div id="upiOption" class="hidden">
      <p>Scan to pay with any UPI app</p>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=anieshmaramesh@oksbi&pn=Jai%20Shriram%20Engineering%20College&mc=&tid=&tr=&tn=Bus%20Fees%20Payment&am=&cu=INR" alt="UPI QR Code">
      <div class="payment-info">
        <div class="bank-info">KVB Karur Vysya Bank 4519 ></div>
        <div class="upi-id">UPI ID: anieshmaramesh@oksbi</div>
      </div>
    </div>

    <div id="upiidOption" class="hidden">
      <p>Use this UPI ID to pay:</p>
      <div class="payment-info">
        <div class="bank-info">KVB Karur Vysya Bank 4519 ></div>
        <div class="upi-id">anieshmaramesh@oksbi</div>
        <p>Use this UPI ID in any UPI app to complete your payment</p>
      </div>
    </div>

    <div id="gpayOption" class="hidden">
      <p>Scan to pay using GPay:</p>
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=anieshmaramesh@oksbi&pn=Jai%20Shriram%20Engineering%20College&mc=&tid=&tr=&tn=Bus%20Fees%20Payment&am=&cu=INR" alt="GPay QR Code">
      <div class="payment-info">
        <div class="bank-info">KVB Karur Vysya Bank 4519 ></div>
        <div class="upi-id">UPI ID: anieshmaramesh@oksbi</div>
      </div>
    </div>

    <div id="cardOption" class="hidden">
      <p>Enter your card details:</p>
      <input type="text" placeholder="Card Number">
      <input type="text" placeholder="Name on Card">
      <input type="month" placeholder="Expiry">
      <input type="password" placeholder="CVV">
    </div>

    <label for="amount">Enter Amount to Pay (â‚¹)</label>
    <input type="number" id="amount" min="0">

    <button onclick="confirmPayment()">Confirm Payment</button>
  </div>
</div>

<!-- Bill Section -->
<div class="container hidden" id="billSection">
  <div class="logo"></div>
  <h2>Payment Receipt</h2>
  <p id="billDetails"></p>
  <button id="generateBtn" onclick="generateBusPass()">Generate Bus Pass</button>
</div>

<!-- Bus Pass Section -->
<div class="container hidden" id="busPassSection">
  <div class="logo"></div>
  <h2>Your Bus Pass</h2>
  <canvas id="busPassCanvas" width="500" height="300"></canvas>
  <button id="downloadBtn">Download Bus Pass</button>
</div>

<script>
  const stopToBus = {
    "Puthu road": "14", "Kovilvali": "14", "GH": "14", "Tirupur": "14",
    "Avinashipalayam": "15", "Kadaiyur": "15", "Kangeyam": "15", "Vellakovil": "15",
    "Koduvai": "18", "Madhapur": "18", "Pongalur": "18", "Palladam": "18",
    "Varapalayam": "20", "Kangeyam privu": "20", "Tharapuram": "20"
  };

  const busStops = {
    "14": { "Puthu road": 5000, "Kovilvali": 5500, "GH": 7500, "Tirupur": 8000 },
    "15": { "Avinashipalayam": 5000, "Kadaiyur": 5500, "Kangeyam": 7500, "Vellakovil": 8000 },
    "18": { "Koduvai": 5000, "Madhapur": 5500, "Pongalur": 7500, "Palladam": 8000 },
    "20": { "Varapalayam": 5000, "Kangeyam privu": 5500, "Tharapuram": 7500 }
  };

  let currentStudent = {};
  let photoData = "";
  let paymentValid = false;

  function showSignUp() {
    document.getElementById('signInSection').classList.add('hidden');
    document.getElementById('signUpSection').classList.remove('hidden');
  }

  function showSignIn() {
    document.getElementById('signUpSection').classList.add('hidden');
    document.getElementById('signInSection').classList.remove('hidden');
  }

  function registerUser() {
    const regNo = document.getElementById('regNo').value.trim();
    const dob = document.getElementById('dob').value;
    const name = document.getElementById('name').value.trim();
    const dept = document.getElementById('dept').value.trim();
    const year = document.getElementById('year').value;
    const stop = document.getElementById('stop').value;
    const photo = document.getElementById('photo').files[0];

    if (!regNo || !dob || !name || !dept || !year || !stop || !photo) {
      alert("Please fill all fields!");
      return;
    }

    const busNo = stopToBus[stop];
    const fee = busStops[busNo][stop];

    const reader = new FileReader();
    reader.onload = function(e) {
      photoData = e.target.result;

      const student = { regNo, dob, name, dept, year, stop, busNo, fee, photoData };
      localStorage.setItem(regNo, JSON.stringify(student));
      alert("Registration successful! You can now Sign In.");
      showSignIn();
    };
    reader.readAsDataURL(photo);
  }

  function signIn() {
    const regNo = document.getElementById('signInRegNo').value.trim();
    const dob = document.getElementById('signInDob').value;

    if (!regNo || !dob) {
      alert("Please fill all fields!");
      return;
    }

    const savedData = localStorage.getItem(regNo);
    if (!savedData) {
      alert("No account found! Please Sign Up first.");
      return;
    }

    const student = JSON.parse(savedData);
    if (student.dob !== dob) {
      alert("Incorrect Date of Birth!");
      return;
    }

    currentStudent = student;
    photoData = student.photoData;

    document.getElementById('signInSection').classList.add('hidden');
    document.getElementById('paymentSection').classList.remove('hidden');

    document.getElementById('studentSummary').innerHTML = `
      <strong>Name:</strong> ${student.name}<br>
      <strong>Department:</strong> ${student.dept}<br>
      <strong>Year:</strong> ${student.year}<br>
      <strong>Stop:</strong> ${student.stop}<br>
      <strong>Bus No:</strong> ${student.busNo}<br>
      <strong>Bus Fee:</strong> â‚¹${student.fee}
    `;
    document.getElementById('amount').value = student.fee;
  }

  function showPaymentOption() {
    const method = document.getElementById('paymentMethod').value;
    const qrSection = document.getElementById('paymentOptions');
    qrSection.classList.remove('hidden');

    ["upiOption","upiidOption","gpayOption","cardOption"].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });

    if (method === "upi") document.getElementById("upiOption").classList.remove("hidden");
    if (method === "upiid") document.getElementById("upiidOption").classList.remove("hidden");
    if (method === "gpay") document.getElementById("gpayOption").classList.remove("hidden");
    if (method === "card") document.getElementById("cardOption").classList.remove("hidden");
  }

  function confirmPayment() {
    const amount = parseFloat(document.getElementById('amount').value);
    const method = document.getElementById('paymentMethod').value;

    if (!amount || amount <= 0 || !method) {
      alert("Please fill all payment fields!");
      return;
    }

    const totalFee = currentStudent.fee;
    const balance = totalFee - amount;
    const balanceText = balance > 0 
      ? â‚¹${balance} (Remaining) 
      : (balance === 0 ? "â‚¹0 (Fully Paid)" : Overpaid by â‚¹${Math.abs(balance)});

    // ðŸ”¹ Set validity condition
    paymentValid = amount >= 1000;

    document.getElementById('paymentSection').classList.add('hidden');
    document.getElementById('billSection').classList.remove('hidden');

    const statusMsg = paymentValid 
      ? "âœ… Payment Successful (Eligible for Bus Pass)"
      : "âš  Payment below â‚¹1000 â€” Bus Pass cannot be generated";

    document.getElementById('billDetails').innerHTML = `
      <strong>Name:</strong> ${currentStudent.name}<br>
      <strong>Department:</strong> ${currentStudent.dept}<br>
      <strong>Year:</strong> ${currentStudent.year}<br>
      <strong>Stop:</strong> ${currentStudent.stop}<br>
      <strong>Bus Number:</strong> ${currentStudent.busNo}<br>
      <strong>Bus Fee:</strong> â‚¹${totalFee}<br>
      <strong>Amount Paid:</strong> â‚¹${amount}<br>
      <strong>Balance Amount:</strong> ${balanceText}<br>
      <strong>Payment Method:</strong> ${method.toUpperCase()}<br>
      <strong>Status:</strong> ${statusMsg}
    `;

    const generateBtn = document.getElementById('generateBtn');
    generateBtn.disabled = !paymentValid;
  }

  function generateBusPass() {
    if (!paymentValid) {
      alert("You must pay at least â‚¹1000 to generate the bus pass.");
      return;
    }

    document.getElementById('billSection').classList.add('hidden');
    document.getElementById('busPassSection').classList.remove('hidden');

    const canvas = document.getElementById('busPassCanvas');
    const ctx = canvas.getContext('2d');

    const img = new Image();
    img.onload = function() {
      // Draw background
      ctx.fillStyle = "#fdf6e3";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Draw header
      ctx.fillStyle = "#003366";
      ctx.fillRect(0, 0, canvas.width, 80);

      // Draw college logo on the bus pass
      const logoImg = new Image();
      logoImg.onload = function() {
        ctx.drawImage(logoImg, 10, 10, 60, 60);
        
        // Draw text
        ctx.fillStyle = "#ffffff";
        ctx.font = "bold 18px Arial";
        ctx.fillText("JAI SHRIRAM ENGINEERING COLLEGE, TIRUPUR", 80, 30);

        ctx.font = "bold 20px Arial";
        ctx.fillText("STUDENT BUS PASS", 170, 60);

        ctx.fillStyle = "#000000";
        ctx.font = "16px Arial";
        ctx.fillText("Name: " + currentStudent.name, 30, 110);
        ctx.fillText("Department: " + currentStudent.dept, 30, 140);
        ctx.fillText("Year: " + currentStudent.year, 30, 170);
        ctx.fillText("Stop: " + currentStudent.stop, 30, 200);
        ctx.fillText("Bus No: " + currentStudent.busNo, 30, 230);
        ctx.fillText("Valid Until: 31-Dec-2025", 30, 260);

        // Draw student photo
        ctx.drawImage(img, 380, 100, 100, 100);
      };
      logoImg.src = "https://educrib-uploads.blr1.cdn.digitaloceanspaces.com/colleges/logos/Jai%20Shriram%20Engineering%20College%2C%20Tirupur%20logo.jpg";
    };
    img.src = currentStudent.photoData;

    document.getElementById('downloadBtn').onclick = function() {
      const link = document.createElement('a');
      link.download = 'student_bus_pass.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    };
  }
</script>

</body>
</html>